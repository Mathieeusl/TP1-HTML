<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title></title>
	<script src="jquery-3.3.1.js"></script>
	<script src="jquery.maskedinput.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<link rel="stylesheet" href="Layout.css">
</head>
<body onload="AfficherListeContact()">

 <div class="container">
            <div class="array-container">
							<h3>Gestionnaire de contacts</h3>
              <div class="header-container">
                    <div class="header-contacts-container">
                        <div>Nom</div>
                        <div>Téléphone</div>
                        <div>Courriel</div>
                        <div>
                            <button id="showAddContact"
                                    tooltip="Ajouter un contact" tooltip-position="left">
                                <span class="glyphicon glyphicon-plus"></span>
                            </button>
                        </div>
                        <div>&nbsp;</div>
                    </div>
                </div>
                <div class="form-container">
                    <div class="form-contact-container" id="contactForm">
                        <div>
                            <input type="hidden" id="Id" />
                            <input type="text" id="nom" placeholder="Nom" class="form-control"/>
                        </div>
                        <div>
                            <input type="text" id="tel" placeholder="Téléphone"  class="phone form-control"/>
                        </div>
                        <div>
                            <input type="text" id="courriel" placeholder="Courriel" class="form-control"/>
                        </div>
                        <div>
                            <button id="addContact" tooltip="Ajouter" tooltip-position="left">
                                <span class="glyphicon glyphicon glyphicon-ok"></span>
                            </button>
                            <button id="modifyContact" tooltip="Modifier" tooltip-position="left">
                                <span class="glyphicon glyphicon-ok"></span>
                            </button>
                        </div>
                        <div>
                            <button id="cancel" tooltip="Annuler" tooltip-position="left">
                                <span  class="glyphicon glyphicon-repeat"></span>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="contact-list-scroll-containter">
                    <div class="contact-list-container" id="contactList">
                    </div>
                </div>
            </div>
        </div>

        <script>

            "use strict";

        	$(document).ready(initUI);

					class Contact {
					  constructor(nom, tel, courriel) {
					    this.nom = nom;
					    this.tel = tel;
					    this.courriel = courriel;
					  }
					}

					let contacts = [
					  new Contact("Étienne Forest", "(514)333-9999", "Etienne.Forest@clg.qc.ca"),
					  new Contact("François Boileau", "(450)430-3120", "François.Boileau@clg.qc.ca"),
					  new Contact("Jean Baudet", "(438)012-9321", "Jean.Baudet@clg.qc.ca"),
					  new Contact("Joan Sébastien-Morales", "(450)430-3120", "Joan.Morales@clg.qc.ca"),
					  new Contact("Kyle Ross", "(514)123-1234", "Kyle.Ross@clg.qc.ca"),
					  new Contact("Marc Beaulne", "(450)111-3333", "Marc.Beaulne@clg.qc.ca"),
					  new Contact("Nicolas Chourot", "(514)123-3456", "Nicolas.Chourot@clg.qc.ca"),
					  new Contact("Saliha Yacoub", "(450)430-3120", "Saliha.Yacoub@clg.qc.ca")
					];


            let editMode = false;
            let addMode = false;

            function initUI() {
                eraseForm();

                $("#addContact").click(AjouterUnContact);
                $("#showAddContact").click(showAddContact);
                $("#modifyContact").click(ModifierUnContact);
                $("#cancel").click(eraseForm);
                $("#nom").keypress(textInputAlphaFilter);

            }

            function eraseForm() {
                addMode = false;
                editMode = false;

                $("#contactForm").hide();

                $("#AjouterUnContact").show();
              	$("#ModifierUnContact").hide();
                $('#showAddContact').show();

                $("#nom").val("");
                $("#tel").val("");
                $("#courriel").val("");

                $("#contactList button").hide();
            }

            function showAddContact() {
                addMode = true;
                $("#contactForm").show();
                $("#showAddContact").hide();
            }

            function showEditContact(e){
                editMode = true;
                $("#showAddContact").hide();
                $("#addContact").hide();
                $("#contactForm").show();
            }

						function AjouterDivContact(ContenuDiv, Classe){
                return $("<div class='" + Classe + "'>" + ContenuDiv + "</div>");
            }

						function AjouterBoutton(Classe, tooltip) {
                return $('<button class="'+ Classe + '"tooltip="' + tooltip + '" tooltip-position="left"></button>');
            }

            function AjouterIcone(idIcone){
                return $("<span class='glyphicon glyphicon-" + idIcone + "'></span>");
            }

			function AfficherListeContact()
			{
		          for (let i = 0; i < contacts.length; i++)
				    {
						let rowClasse;

						if((i + 1) % 2 === 0)
						{
							rowClasse = "rangeePaire";
						}
						else
						{
							rowClasse = "rangeeImpaire";
						}

						$("#contactList").append(AjouterDivContact(contacts[i].nom, rowClasse));
						$("#contactList").append(AjouterDivContact(contacts[i].tel, rowClasse));
						$('#contactList").append(AjouterDivContact(contacts[i].courriel, rowClasse));

						$("#contactList").append(AjouterDivContact("", rowClasse).append(AjouterBoutton("editContact","Modifier "+ contacts[i].nom).append(AjouterIcone('pencil'))));

						$("#contactList").append(AjouterDivContact("", rowClasse).append(AjouterBoutton("deleteContact","Effacer "+ contacts[i].nom).append(AjouterIcone('remove'))));
					}

			}

             // Ajout d'un contact
            function AjouterUnContact() {
                if (validationProvider.isValid()) {

                    let Nom = $("#nom").val();
                    let Tel = $("#tel").val()
                    let Courriel = $("#courriel").val();

                    let NouvContact = new Contact(Nom, Tel, Courriel);
										contacts.push(NouvContact);
                }

								eraseForm();
								AfficherListeContact();
            }

            // Requête au service Web API: Modification d'un contact
            function ModifierUnContact() {
                // construction de l'objet contact
                let contact = makeContactFromForm(true);
                if (validationProvider.isValid()) {
                    webAPI_modifyContact(contact, getContacts, insertErrorStatus);
                }
            }

            // Après confirmation, requête au service Web API de retrait d'un contact
            function SupprimerUnContact(e) {
                // Extraction du Id du contact inscrit dans l'attribut id de l'élément déclencheur de l'événement click
                let contactId = e.currentTarget.id.split('_')[1];
                webAPI_getContact(contactId, confirmDeleteContact, insertErrorStatus);
            }

            function confirmDeleteContact(contact) {
                $.confirm({
                    title: "Attention!",
                    content: "Effacer "+ contact.Name +"?",
                    buttons: {
                        confirmer: function () {
                            webAPI_deleteContact(contact.Id, getContacts, insertErrorStatus);
                        },
                        annuler: {},
                    }
                });
            }

            function initValidation() {
                $(".phone").mask("(999) 999-9999");
                validationProvider = new ValidationProvider();
                validationProvider.addControl("Name", validate_Name);
                validationProvider.addControl("Phone", validate_Phone);
                validationProvider.addControl("Email", validate_email);
            }

            function resetValidation() {
                validationProvider.reset();
            }

            function validate_Name(){
                let TBX_FirstName = document.getElementById("Name");

                if (TBX_FirstName.value === "")
                    return "Nom manquant";

                return "";
            }

            function validate_Phone(){
                let TBX_LastName = document.getElementById("Phone");

                if (TBX_LastName.value === "")
                    return "Téléphone manquant";

                return "";
            }

            function validate_email(){
                let TBX_Email = document.getElementById("Email");
                let emailRegex = /^([\w\.\-]+)@([\w\-]+)((\.(\w){2,3})+)$/;

                if (TBX_Email.value === "")
                    return "Adresse de courriel manquante";

                if (!emailRegex.test(TBX_Email.value))
                    return "Adresse de courriel invalide";

                return "";
            }


        </script>
</body>
</html>
